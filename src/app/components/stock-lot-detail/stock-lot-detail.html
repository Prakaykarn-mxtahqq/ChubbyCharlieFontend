<div class="main-container" *ngIf="!loading && stockLot">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-text">
          <h1>{{stockLot.lotName}}</h1>
          <p>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Stock Lot</p>
        </div>
        <span class="status-badge" [ngClass]="getStatusBadgeClass()">
          {{getStatusLabel()}}
        </span>
      </div>
    </div>

    <!-- Stock Lot Info Card -->
    <div class="info-card">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Stock Lot</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">‡∏ä‡∏∑‡πà‡∏≠ Lot:</span>
          <span class="value">{{stockLot.lotName}}</span>
        </div>
        <div class="info-item">
          <span class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
          <span class="value">{{getStatusLabel()}}</span>
        </div>
        <div class="info-item">
          <span class="label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤:</span>
          <span class="value">{{formatDate(stockLot.importDate)}}</span>
        </div>
        <div class="info-item">
          <span class="label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ñ‡∏∂‡∏á:</span>
          <span class="value">{{formatDate(stockLot.arrivalDate)}}</span>
        </div>
      </div>
    </div>

    <!-- Items Card -->
    <div class="items-card">
      <div class="card-header">
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ({{stockLot.items?.length || 0}} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
        <div class="add-items-buttons">
        </div>
      </div>

      <div class="items-list" *ngIf="stockLot.items && stockLot.items.length > 0">
        <div class="item" *ngFor="let item of stockLot.items; let i = index">
          <div class="item-number">{{i + 1}}</div>
          <div class="item-details">
            <div class="item-name">{{item.productName || item.name || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}}</div>
            <div class="item-info">
              <span *ngIf="item.quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {{item.quantity}}</span>
              <span *ngIf="getItemUnitPrice(item)">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢: {{formatCurrency(getItemUnitPrice(item))}}</span>
            </div>
          </div>
          <div class="item-cost">
            {{formatCurrency(getItemTotalCost(item))}}
          </div>
        </div>
      </div>

      <div class="no-items" *ngIf="!stockLot.items || stockLot.items.length === 0">
        <i class="bi bi-inbox"></i>
        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô Stock Lot ‡∏ô‡∏µ‡πâ</p>
        <div class="add-first-items-buttons">
          <button class="add-first-item-btn china" (click)="addChinaStock()">
            <i class="bi bi-geo-alt-fill"></i>
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô
          </button>
          <button class="add-first-item-btn thai" (click)="addThaiStock()">
            <i class="bi bi-house-fill"></i>
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ó‡∏¢
          </button>
        </div>
      </div>

      <!-- Summary -->
      <div class="summary-section" *ngIf="stockLot.items && stockLot.items.length > 0">
        <div class="summary-row">
          <span class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
          <span class="value">{{stockLot.items.length}} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
        </div>
        <div class="summary-row total">
          <span class="label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
          <span class="value">{{formatCurrency(totalCost)}}</span>
        </div>
      </div>
    </div>

    <!-- Actions Card -->
    <div class="actions-card">
      <h3>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>

      <div class="actions-grid">
        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô -->
        <button
          class="action-btn china"
          (click)="addChinaStock()"
          [disabled]="stockLot.status === 'COMPLETED'">
          <i class="bi bi-geo-alt-fill"></i>
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô
        </button>

        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ó‡∏¢ -->
        <button
          class="action-btn thai"
          (click)="addThaiStock()"
          [disabled]="stockLot.status === 'COMPLETED'">
          <i class="bi bi-house-fill"></i>
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ó‡∏¢
        </button>
        <!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
        <button
          class="action-btn primary"
          (click)="editStockLot()"
          [disabled]="stockLot.status === 'COMPLETED'">
          <i class="bi bi-pencil"></i>
          ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Stock Lot
        </button>


        <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        <button
          class="action-btn info"
          (click)="updateStatus('ARRIVED')"
          [disabled]="stockLot.status === 'COMPLETED' || stockLot.status === 'ARRIVED'">
          <i class="bi bi-truck"></i>
          ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß
        </button>
        <!-- ‚≠ê Complete & Create Transaction (‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å) -->
        <button
          class="action-btn complete-btn"
          (click)="completeStockLot()"
          [disabled]="stockLot.status === 'COMPLETED' || !stockLot.items || stockLot.items.length === 0">
          <i class="bi bi-check-circle-fill"></i>
          Complete & Create Transaction
        </button>
        <!-- ‡∏•‡∏ö -->
        <button
          class="action-btn danger"
          (click)="deleteStockLot()"
          [disabled]="stockLot.status === 'COMPLETED'">
          <i class="bi bi-trash"></i>
          ‡∏•‡∏ö Stock Lot
        </button>

        <!-- ‡∏Å‡∏•‡∏±‡∏ö -->
        <button class="action-btn secondary" (click)="goBack()">
          <i class="bi bi-arrow-left"></i>
          ‡∏Å‡∏•‡∏±‡∏ö
        </button>
      </div>

      <!-- Help Text -->
      <div class="help-text" *ngIf="stockLot.status !== 'COMPLETED'">
        <i class="bi bi-info-circle"></i>
        <div>
          <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong>
          <ol>
            <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ Stock Lot
              <ul>
                <li><strong>üá®üá≥ ‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô"</li>
                <li><strong>üáπüá≠ ‡∏à‡∏≤‡∏Å‡πÑ‡∏ó‡∏¢:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ó‡∏¢"</li>
              </ul>
            </li>
            <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</li>
            <li>‡∏Ñ‡∏•‡∏¥‡∏Å "Complete & Create Transaction" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Transaction ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
          </ol>
        </div>
      </div>

      <div class="completed-notice" *ngIf="stockLot.status === 'COMPLETED'">
        <i class="bi bi-check-circle-fill"></i>
        <span>Stock Lot ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å Complete ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ</span>
      </div>
    </div>
  </div>
</div>

<div class="loading-container" *ngIf="loading">
  <div class="spinner"></div>
  <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
</div>
